{% extends 'base.html' %}
{% load static %}

{% block title %}Categories - FinFlow{% endblock %}
{% block page_title %}Categories{% endblock %}

{% block content %}
<div class="grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6">
    <!-- Income Categories -->
    <div class="bg-custom-card border border-custom-border rounded-lg p-4 md:p-6">
        <div class="flex items-center justify-between mb-4 md:mb-6">
            <h3 class="text-lg md:text-xl font-semibold">Income Categories</h3>
            <button class="px-3 py-1 text-sm bg-green-600 border border-green-600 text-white rounded-lg hover:bg-green-700 transition-colors whitespace-nowrap active:scale-90 active:bg-red-600 active:border-red-600" onclick="showAddCategoryModal('income')">
                + Add
            </button>
        </div>

        {% if income_categories %}
        <div class="space-y-3">
            {% for category in income_categories %}
            <div class="flex items-center justify-between p-3 bg-custom-muted rounded-lg hover:bg-custom-muted/80 transition-colors gap-2">
                <div class="min-w-0">
                    <p class="text-sm md:text-base font-medium truncate">{{ category.name }}</p>
                    <p class="text-xs text-custom-muted-foreground">{{ category.transaction_count }} transactions</p>
                </div>
                <div class="flex gap-1 md:gap-2 whitespace-nowrap">
                    <button class="text-blue-800 border border-blue-800 hover:bg-blue-800 hover:text-white px-2 py-1 rounded-lg active:scale-95 text-xs md:text-sm" onclick="editCategory({{ category.id }})">Edit</button>
                    <form method="POST" action="{% url 'finflow:delete_category' category.id %}" style="display:inline;" onsubmit="return confirm('Are you sure?')">
                        {% csrf_token %}
                        <button type="submit" class="text-white bg-red-600 hover:bg-transparent border border-custom-destructive hover:text-custom-destructive px-2 py-1 rounded-lg active:scale-95 text-xs md:text-sm">Delete</button>
                    </form>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p class="text-xs md:text-sm text-custom-muted-foreground text-center py-6">No income categories yet</p>
        {% endif %}
    </div>

    <!-- Expense Categories -->
    <div class="bg-custom-card border border-custom-border rounded-lg p-4 md:p-6">
        <div class="flex items-center justify-between mb-4 md:mb-6">
            <h3 class="text-lg md:text-xl font-semibold">Expense Categories</h3>
            <button class="px-3 py-1 text-sm bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors whitespace-nowrap active:scale-90 active:bg-transparent active:text-red-600 border border-red-600" onclick="showAddCategoryModal('expense')">
                + Add
            </button>
        </div>

        {% if expense_categories %}
        <div class="space-y-3">
            {% for category in expense_categories %}
            <div class="flex items-center justify-between p-3 bg-custom-muted rounded-lg hover:bg-custom-muted/80 transition-colors gap-2">
                <div class="min-w-0">
                    <p class="text-sm md:text-base font-medium truncate">{{ category.name }}</p>
                    <p class="text-xs text-custom-muted-foreground">{{ category.transaction_count }} transactions</p>
                </div>
                <div class="flex gap-1 md:gap-2 whitespace-nowrap">
                    <button class="text-blue-800 bg-transparent border hover:bg-blue-800 border-blue-800 hover:text-white px-2 py-1 rounded-lg active:scale-95 text-xs md:text-sm" onclick="editCategory({{ category.id }})">Edit</button>
                    <form method="POST" action="{% url 'finflow:delete_category' category.id %}" style="display:inline;" onsubmit="return confirm('Are you sure?')">
                        {% csrf_token %}
                        <button type="submit" class="text-white bg-red-600 hover:bg-transparent border border-red-600 hover:text-red-600 px-2 py-1 rounded-lg active:scale-95 text-xs md:text-sm">Delete</button>
                    </form>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p class="text-xs md:text-sm text-custom-muted-foreground text-center py-6">No expense categories yet</p>
        {% endif %}
    </div>
</div>

<!-- Add Category Modal -->
<div id="addCategoryModal" class="hidden fixed inset-0 backdrop-blur-sm bg-black/50 flex items-center justify-center z-50 p-4">
    <div class="bg-custom-card rounded-lg p-4 md:p-6 w-full max-w-md shadow-xl max-h-screen overflow-y-auto">
        <h3 class="text-lg md:text-xl font-semibold mb-4">Add Category</h3>
        
        <form method="POST" class="space-y-4" action="{% url 'finflow:add_category' %}">
            {% csrf_token %}

            <div>
                <label class="block text-sm font-medium mb-2">Name</label>
                <input type="text" name="name" required class="w-full px-3 md:px-4 py-2 text-sm border border-custom-border rounded-lg focus:outline-none focus:ring-2 focus:ring-custom-accent" placeholder="Enter category name">
            </div>

            <input type="hidden" name="category_type" id="categoryType" value="">

            <div class="flex flex-col sm:flex-row gap-3 pt-4">
                <button type="button" onclick="closeAddCategoryModal()" class="flex-1 px-4 py-2 text-sm border border-custom-border rounded-lg hover:bg-custom-muted transition-colors">
                    Cancel
                </button>
                <button type="submit" class="flex-1 px-4 py-2 text-sm bg-blue-800 text-custom-accent-foreground rounded-lg hover:bg-custom-accent/90 transition-colors">
                    Add Category
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    function showAddCategoryModal(type) {
        document.getElementById('categoryType').value = type;
        document.getElementById('addCategoryModal').classList.remove('hidden');
    }

    function closeAddCategoryModal() {
        document.getElementById('addCategoryModal').classList.add('hidden');
    }

    function editCategory(id) {
        alert('Edit category ' + id + ' - implement as needed');
    }

    document.getElementById('addCategoryModal').addEventListener('click', function(e) {
        if (e.target === this) {
            closeAddCategoryModal();
        }
    });
</script>
{% endblock %}
